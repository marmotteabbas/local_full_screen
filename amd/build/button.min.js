/**
 * A javascript module that adds the fullscreen button to a page.
 *
 * @module     local_fullscreen/button
 * @package    local_fullscreen
 * @copyright  2018 University of Nottingham
 * @author     Neill Magill <neill.magill@nottingham.ac.uk>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/ define(["jquery","core/log","core/templates","core/ajax","core/notification"],function(e,l,t,n,r){var o,a,s={attachBoost:"#region-main > .card-block",attachClean:"#region-main",button:".local-fullscreen"},c={toggle:"fullscreenmode",fixed:"fixed",float:"float"},u=!1,i=function(l){var t=e(l),n=e(s.attachBoost);0===n.length&&(n=e(s.attachClean)),n.prepend(t),e(s.button).click(p);var r=e(document);r.keydown(f),r.keyup(m),r.scroll(g)},d=function(){null===(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)&&h()},f=function(e){!0!==u&&"b"===e.key&&!1!==e.ctrlKey&&!1!==e.altKey&&(u=!0,p(e))},m=function(e){!1!==u&&"b"===e.key&&!1!==e.ctrlKey&&!1!==e.altKey&&(u=!1)},g=function(){window.pageYOffset>205?e(s.button).addClass(c.float):e(s.button).removeClass(c.float)},p=function(){var l,t=e("body"),n=e(s.button);t.hasClass(c.toggle)?(e("#page-header").hide(),e("#top-footer").hide(),e("#nav-drawer").hide(),e("#page-footer").hide(),e("#nav-drawer-footer").hide(),e(".fixed-top").hide(),e("#page").addClass("temp_page_full_screen"),e(".temp_page_full_screen").removeAttr("id"),e("body").addClass("tempory_margin_zero"),t.removeClass(c.toggle),n.attr("aria-checked","false"),l=!1):h(),b(),F(l)},h=function(){var l,t=e("body"),n=e(s.button);e("#page-header").show(),e("#top-footer").show(),e("#nav-drawer").show(),e("#page-footer").show(),e("#nav-drawer-footer").show(),e(".fixed-top").show(),e(".temp_page_full_screen").attr("id","page"),e("#page").removeClass("temp_page_full_screen"),e("body").removeClass("tempory_margin_zero"),t.addClass(c.toggle),n.attr("aria-checked","true"),l=!0},b=function(){var e=document.fullscreenElement&&null!==document.fullscreenElement||document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||document.mozFullScreenElement&&null!==document.mozFullScreenElement||document.msFullscreenElement&&null!==document.msFullscreenElement,l=document.documentElement;e?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():l.requestFullscreen?l.requestFullscreen():l.mozRequestFullScreen?l.mozRequestFullScreen():l.webkitRequestFullScreen?l.webkitRequestFullScreen():l.msRequestFullscreen&&l.msRequestFullscreen()},F=function(e){return n.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:"fullscreenmode",value:e}]}}])[0].fail(r.exception)};return{init:(o=!0,l.debug("Adding fullscreen button to the page (fullscreen="+o+")","local_fullscreen/button"),a={fullscreen:!1},!0==o&&(e("body").addClass(c.toggle),a.fullscreen=!0),document.addEventListener("fullscreenchange",d,!1),document.addEventListener("webkitfullscreenchange",d,!1),document.addEventListener("mozfullscreenchange",d,!1),t.render("local_fullscreen/button",a).then(i))}});